# language setting
language: python

# version numbers test
python:
    - "3.8"

build:
    ci:
        # Required to display test results in Shippable GUI
        - mkdir -p shippable/testresults
        - mkdir -p shippable/codecoverage

        # Install Python dependencies
        - python --version
        - pip install --upgrade pip
        - pip install pipenv
        - pipenv install --dev

        # Run linter
        - flake8 app
        - flake8 tests

        # Run Python tests
        - pytest ./tests --junitxml=./shippable/testresults/flask_bootstrap.xml --cov=app --cov-report xml:./shippable/codecoverage/coverage.xml


    on_success:
        # Run deploy script to manage deploy to appropriate environment
        - . ./devops/ci/shippable_deploy.sh

integrations:
    notifications:
        - integrationName: email
          type: email
          recipients:
              - iain.hunter@outlook.com
