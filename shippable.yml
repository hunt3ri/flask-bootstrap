# language setting
language: python

# version numbers test
python:
    - "3.7"

env:
    global:
        - secure: Umu4hmgkUjfERpE8FlsXasGKi7zrrzMQjDkR2WpN7CzBE/+BQBPwNoUgJLuGCTGp9jo+OnanHLakIYQbrsz/tfokA/1eQQUxEvLedT98myKaTP6b6g0SNgLdWbmIog8GwyTt6UPKErA7xh+k6Dvl4+JCDQ+HWRp2Mvb+BgT/Dv3ltV9ncAVqU/PK0lZNAmT/Ldt686CJYzjuwl1DLr3vkhjy41IejpCnpOTQ6dkaZdj51yl3JNxjJEy5QzwDat92rD3vL3aF6rkQTi6lY274nz9y0oOSBRRtiKJ5qKTltmgISn/gscYHkCOIcJV/hhi7T/32KUpoAhp7BQzkVEW+RQ==

build:
    ci:
        # Required to display test results in Shippable GUI
        - mkdir -p shippable/testresults
        - mkdir -p shippable/codecoverage

        # Install Python dependencies
        - python --version
        - pip install --upgrade pip
        - pip install pipenv
        - pipenv install --dev

        # Run linter
        - flake8 app
        - flake8 tests

        # Run Python tests
        - pytest ./tests --junitxml=./shippable/testresults/flask_bootstrap.xml --cov=app --cov-report xml:./shippable/codecoverage/coverage.xml


    on_success:
        # Run deploy script to manage deploy to appropriate environment
        - . ./devops/ci/shippable_deploy.sh

integrations:
    notifications:
        - integrationName: email
          type: email
          recipients:
              - iain.hunter@outlook.com
